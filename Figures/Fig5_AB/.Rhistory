dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
library(tidyverse)
dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
meta <- read.csv("~/RumenCampylobacter2022/Raw/metadata_feeding_trial.csv")
meta_clean <- meta %>%
gather(SCFA, Concentration, -ID, -Timepoint, -Cow, -Additive) %>%
group_by(ID, SCFA) %>%
mutate(Min = min(Concentration)) %>%
ungroup() %>%
select(-Concentration) %>%
gather(Metric, Concentration, -ID, -Timepoint, -Cow, -Additive, -SCFA) %>%
unite(SCFA, c("SCFA", "Metric"), sep = "_") %>%
select(-Timepoint, -Cow) %>%
distinct() %>%
spread(SCFA, Concentration)
meta_clean$ID <- as.character(meta_clean$ID)
View(dPCR_pops)
qPCR_16s <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv", sheet = "16S_qPCR")
library(tidyverse)
qPCR_16s <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/qPCR_feeding_trial.csv")
meta <- read.csv("~/RumenCampylobacter2022/Raw/metadata_feeding_trial.csv")
meta_clean <- meta %>%
gather(SCFA, Concentration, -ID, -Timepoint, -Cow, -Additive) %>%
group_by(ID, SCFA) %>%
mutate(Min = min(Concentration)) %>%
ungroup() %>%
select(-Concentration) %>%
gather(Metric, Concentration, -ID, -Timepoint, -Cow, -Additive, -SCFA) %>%
unite(SCFA, c("SCFA", "Metric"), sep = "_") %>%
select(-Timepoint, -Cow) %>%
distinct() %>%
spread(SCFA, Concentration)
meta_clean$ID <- as.character(meta_clean$ID)
qPCR_16s_clean <- qPCR_16s %>%
distinct()
compiled <- full_join(qPCR_16s, dPCR_pops) %>%
filter(!(is.na(SampleName))) %>%
distinct() %>%
mutate(`16S_total_copies` = as.numeric(gsub("No Ct", 0, `16S_total_copies`))) %>%
separate(ID, into=c("Run", "Day", "Cow"), remove = FALSE) %>%
select(-SampleName)
compiled_long <- compiled %>%
gather(Measurement, Copies, -ID, -Run, -Day, -Cow) %>%
distinct() %>%
group_by(Run, Day, Measurement) %>%
mutate(n = n()) %>%
mutate(Median = median(Copies)) %>%
mutate(SD = sd(Copies)) %>%
ungroup()
ggplot(compiled_long, aes(x=Day, y=Median)) +
geom_bar(stat="identity", color="black", position=position_dodge()) +
facet_grid(Measurement ~ Run, scales = "free") +
geom_errorbar(aes(ymin=Median, ymax=Median+SD), width=.2,position=position_dodge(.9))
population_raio_variance <- compiled_long %>%
filter(Measurement != "16S_total_copies")
ggplot(population_raio_variance, aes(x=Day, y=Copies)) +
geom_point(aes(colour=Measurement)) +
scale_y_continuous(trans='log2') +
facet_grid(Cow ~ Run) +
theme_bw()
library(corrplot)
correlation <- inner_join(compiled, meta_clean) %>%
select(-`16S_total_copies`, -Butyrate_uM_Min, -Caproate_uM_Min, -Valerate_uM_Min) %>%
select(-ID, -Run, -Day, -Cow, -Additive)
colnames(correlation) <- gsub("_uM_Min", "", names(correlation))
corr_mat <- cor(correlation)
corr_mat_testRes = cor.mtest(correlation, conf.level = 0.95)
corrplot(corr_mat, p.mat=corr_mat_testRes$p, method = 'color', diag = FALSE, type = 'upper',
sig.level = c(0.001, 0.01, 0.05), pch.cex = 0.9,
insig = 'label_sig')
corrplot(corr_mat, type="upper", order="original", p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "blank", diag = FALSE)
corrplot(corr_mat, method="circle", col = colorRampPalette(c("red", "black"))(50),
type="lower", order="original",
addCoef.col = "white", # Add coefficient of correlation
tl.col="black", tl.srt=45, #Text label color and rotation
# Combine with significance
p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "pch",
# hide correlation coefficient on the principal diagonal
diag=FALSE)
corrplot(corr_mat, method="circle", col = colorRampPalette(c("red", "black"))(50),
type="lower", order="original",
addCoef.col = "white", # Add coefficient of correlation
tl.col="black", tl.srt=45, #Text label color and rotation
# Combine with significance
p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "pch",
# hide correlation coefficient on the principal diagonal
diag=FALSE)
corrplot(corr_mat, p.mat=corr_mat_testRes$p, method = 'color', diag = FALSE, type = 'upper',
sig.level = c(0.001, 0.01, 0.05), pch.cex = 0.9,
insig = 'label_sig')
corrplot(corr_mat, type="upper", order="original", p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "blank", diag = FALSE)
library(tidyverse)
qPCR_16s <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/qPCR_feeding_trial.csv")
meta <- read.csv("~/RumenCampylobacter2022/Raw/metadata_feeding_trial.csv")
meta_clean <- meta %>%
gather(SCFA, Concentration, -ID, -Timepoint, -Cow, -Additive) %>%
group_by(ID, SCFA) %>%
mutate(Min = min(Concentration)) %>%
ungroup() %>%
select(-Concentration) %>%
gather(Metric, Concentration, -ID, -Timepoint, -Cow, -Additive, -SCFA) %>%
unite(SCFA, c("SCFA", "Metric"), sep = "_") %>%
select(-Timepoint, -Cow) %>%
distinct() %>%
spread(SCFA, Concentration)
meta_clean$ID <- as.character(meta_clean$ID)
qPCR_16s_clean <- qPCR_16s %>%
distinct()
compiled <- full_join(qPCR_16s, dPCR_pops) %>%
filter(!(is.na(SampleName))) %>%
distinct() %>%
mutate(`16S_total_copies` = as.numeric(gsub("No Ct", 0, `16S_total_copies`))) %>%
separate(ID, into=c("Run", "Day", "Cow"), remove = FALSE) %>%
select(-SampleName)
library(corrplot)
correlation <- inner_join(compiled, meta_clean) %>%
select(-`16S_total_copies`, -Butyrate_uM_Min, -Caproate_uM_Min, -Valerate_uM_Min) %>%
select(-ID, -Run, -Day, -Cow, -Additive)
colnames(correlation) <- gsub("_uM_Min", "", names(correlation))
corr_mat <- cor(correlation)
corr_mat_testRes = cor.mtest(correlation, conf.level = 0.95)
corrplot(corr_mat, method="circle", col = colorRampPalette(c("red", "black"))(50),
type="lower", order="original",
addCoef.col = "white", # Add coefficient of correlation
tl.col="black", tl.srt=45, #Text label color and rotation
# Combine with significance
p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "pch",
# hide correlation coefficient on the principal diagonal
diag=FALSE)
)
library(tidyverse)
qPCR_16s <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/qPCR_feeding_trial.csv")
meta <- read.csv("~/RumenCampylobacter2022/Raw/metadata_feeding_trial.csv")
meta_clean <- meta %>%
gather(SCFA, Concentration, -ID, -Timepoint, -Cow, -Additive) %>%
group_by(ID, SCFA) %>%
mutate(Min = min(Concentration)) %>%
ungroup() %>%
select(-Concentration) %>%
gather(Metric, Concentration, -ID, -Timepoint, -Cow, -Additive, -SCFA) %>%
unite(SCFA, c("SCFA", "Metric"), sep = "_") %>%
select(-Timepoint, -Cow) %>%
distinct() %>%
spread(SCFA, Concentration)
meta_clean$ID <- as.character(meta_clean$ID)
qPCR_16s_clean <- qPCR_16s %>%
distinct()
compiled <- full_join(qPCR_16s, dPCR_pops) %>%
filter(!(is.na(SampleName))) %>%
distinct() %>%
mutate(`16S_total_copies` = as.numeric(gsub("No Ct", 0, `16S_total_copies`))) %>%
separate(ID, into=c("Run", "Day", "Cow"), remove = FALSE) %>%
select(-SampleName)
library(corrplot)
correlation <- inner_join(compiled, meta_clean) %>%
select(-`16S_total_copies`, -Butyrate_uM_Min, -Caproate_uM_Min, -Valerate_uM_Min) %>%
select(-ID, -Run, -Day, -Cow, -Additive)
colnames(correlation) <- gsub("_uM_Min", "", names(correlation))
corr_mat <- cor(correlation)
corr_mat_testRes = cor.mtest(correlation, conf.level = 0.95)
corrplot(corr_mat, method="circle", col = colorRampPalette(c("red", "black"))(50),
type="lower", order="original",
addCoef.col = "white", # Add coefficient of correlation
tl.col="black", tl.srt=45, #Text label color and rotation
# Combine with significance
p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "pch",
# hide correlation coefficient on the principal diagonal
diag=FALSE)
library(tidyverse)
qPCR_16s <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/qPCR_feeding_trial.csv")
meta <- read.csv("~/RumenCampylobacter2022/Raw/metadata_feeding_trial.csv")
meta_clean <- meta %>%
gather(SCFA, Concentration, -ID, -Timepoint, -Cow, -Additive) %>%
group_by(ID, SCFA) %>%
mutate(Min = min(Concentration)) %>%
ungroup() %>%
select(-Concentration) %>%
gather(Metric, Concentration, -ID, -Timepoint, -Cow, -Additive, -SCFA) %>%
unite(SCFA, c("SCFA", "Metric"), sep = "_") %>%
select(-Timepoint, -Cow) %>%
distinct() %>%
spread(SCFA, Concentration)
meta_clean$ID <- as.character(meta_clean$ID)
qPCR_16s_clean <- qPCR_16s %>%
distinct()
compiled <- full_join(qPCR_16s, dPCR_pops) %>%
filter(!(is.na(SampleName))) %>%
distinct() %>%
mutate(`16S_total_copies` = as.numeric(gsub("No Ct", 0, `16S_total_copies`))) %>%
separate(ID, into=c("Run", "Day", "Cow"), remove = FALSE) %>%
select(-SampleName)
library(corrplot)
correlation <- inner_join(compiled, meta_clean) %>%
select(-`16S_total_copies`, -Butyrate_uM_Min, -Caproate_uM_Min, -Valerate_uM_Min) %>%
select(-ID, -Run, -Day, -Cow, -Additive)
colnames(correlation) <- gsub("_uM_Min", "", names(correlation))
corr_mat <- cor(correlation)
corr_mat_testRes = cor.mtest(correlation, conf.level = 0.95)
pdf("~/RumenCampylobacter2022/Figures/Fig5_AB/output/fig5_B.pdf", width=6, height=6)
corrplot(corr_mat, method="circle", col = colorRampPalette(c("red", "black"))(50),
type="lower", order="original",
addCoef.col = "white", # Add coefficient of correlation
tl.col="black", tl.srt=45, #Text label color and rotation
# Combine with significance
p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "pch",
# hide correlation coefficient on the principal diagonal
diag=FALSE)
dev.off()
compiled <- read.csv("~/RumenCampylobacter2022/Raw/dPCR_in_vitro.csv") %>%
group_by(Treatment, Measure, Inoculation) %>%
mutate(Avg=mean(Copies)) %>%
mutate(Sd =sd(Copies)) %>%
ungroup() %>%
select(Treatment, Measure, Inoculation, Avg, Sd) %>%
distinct()
compiled_treatment <- compiled %>%
filter(Treatment != "Control")
compiled_control <- compiled %>%
filter(Treatment == "Control") %>%
rename(Avg_control = Avg) %>%
rename(Sd_control = Sd) %>%
select(-Treatment)
fold_change <- inner_join(compiled_treatment, compiled_control) %>%
mutate(fold = Avg / Avg_control) %>%
mutate(fold_sd = Sd / Avg_control)
ggplot(fold_change , aes(x=Treatment, y=fold, fill=Measure)) +
geom_bar(stat="identity", color="black",
position=position_dodge(), alpha = 0.5) +
geom_errorbar(aes(ymin=fold-fold_sd, ymax=fold+fold_sd), width=.2,
position=position_dodge(.9)) +
theme_bw() +
facet_grid(. ~ Inoculation, scales = "free_x", space="free")
library(tidyverse)
compiled <- read.csv("~/RumenCampylobacter2022/Raw/dPCR_in_vitro.csv") %>%
group_by(Treatment, Measure, Inoculation) %>%
mutate(Avg=mean(Copies)) %>%
mutate(Sd =sd(Copies)) %>%
ungroup() %>%
select(Treatment, Measure, Inoculation, Avg, Sd) %>%
distinct()
compiled_treatment <- compiled %>%
filter(Treatment != "Control")
compiled_control <- compiled %>%
filter(Treatment == "Control") %>%
rename(Avg_control = Avg) %>%
rename(Sd_control = Sd) %>%
select(-Treatment)
fold_change <- inner_join(compiled_treatment, compiled_control) %>%
mutate(fold = Avg / Avg_control) %>%
mutate(fold_sd = Sd / Avg_control)
pdf("~/RumenCampylobacter2022/Figures/Fig5_AB/output/fig5_A.pdf", width=9, height=4.5)
ggplot(fold_change , aes(x=Treatment, y=fold, fill=Measure)) +
geom_bar(stat="identity", color="black",
position=position_dodge(), alpha = 0.5) +
geom_errorbar(aes(ymin=fold-fold_sd, ymax=fold+fold_sd), width=.2,
position=position_dodge(.9)) +
theme_bw() +
facet_grid(. ~ Inoculation, scales = "free_x", space="free")
dev.off()
library(tidyverse)
qPCR_16s <- read_csv("~/RumenCampylobacter2022/Raw/dPCR_feeding_trial.csv")
dPCR_pops <- read_csv("~/RumenCampylobacter2022/Raw/qPCR_feeding_trial.csv")
meta <- read.csv("~/RumenCampylobacter2022/Raw/metadata_feeding_trial.csv")
meta_clean <- meta %>%
gather(SCFA, Concentration, -ID, -Timepoint, -Cow, -Additive) %>%
group_by(ID, SCFA) %>%
mutate(Min = min(Concentration)) %>%
ungroup() %>%
select(-Concentration) %>%
gather(Metric, Concentration, -ID, -Timepoint, -Cow, -Additive, -SCFA) %>%
unite(SCFA, c("SCFA", "Metric"), sep = "_") %>%
select(-Timepoint, -Cow) %>%
distinct() %>%
spread(SCFA, Concentration)
meta_clean$ID <- as.character(meta_clean$ID)
qPCR_16s_clean <- qPCR_16s %>%
distinct()
compiled <- full_join(qPCR_16s, dPCR_pops) %>%
filter(!(is.na(SampleName))) %>%
distinct() %>%
mutate(`16S_total_copies` = as.numeric(gsub("No Ct", 0, `16S_total_copies`))) %>%
separate(ID, into=c("Run", "Day", "Cow"), remove = FALSE) %>%
select(-SampleName)
library(corrplot)
correlation <- inner_join(compiled, meta_clean) %>%
select(-`16S_total_copies`, -Butyrate_uM_Min, -Caproate_uM_Min, -Valerate_uM_Min) %>%
select(-ID, -Run, -Day, -Cow, -Additive)
colnames(correlation) <- gsub("_uM_Min", "", names(correlation))
corr_mat <- cor(correlation)
corr_mat_testRes = cor.mtest(correlation, conf.level = 0.95)
pdf("~/RumenCampylobacter2022/Figures/Fig5_AB/output/fig5_B.pdf", width=6, height=6)
corrplot(corr_mat, method="circle", col = colorRampPalette(c("red", "black"))(50),
type="lower", order="original",
addCoef.col = "white", # Add coefficient of correlation
tl.col="black", tl.srt=45, #Text label color and rotation
# Combine with significance
p.mat = corr_mat_testRes$p, sig.level = 0.01, insig = "pch",
# hide correlation coefficient on the principal diagonal
diag=FALSE)
dev.off()
